!function(e){function i(i,t){e("#_img_hide,#_canvas").remove(),e("body").append(e('<canvas id="_canvas" style="display: none;"></canvas><img id="_img_hide" style="display: none;" >'));var a=new Image;a.src=i.src||"",e("#_img_hide").attr("src",i.src)[0].onload=function(){var n=e(this),s=document.getElementById("_canvas"),l=s.getContext("2d");0===i.limit||i.filesize>=i.limit?(console.log(this.width),console.log(this.height),s.width=n.width(),s.height=n.height(),l.drawImage(a,0,0),i.base64=s.toDataURL("image/jpeg",i.quality/100)):i.base64=i.src,i.img.attr({src:i.base64}),t(i)}}e.fn.extend({compressImage:function(t){var a={file:e(t.file),img:e(t.img),limit:t.limit?t.limit:200},n=a.file,s=t.callback||function(){};n.change(function(){var n=e(this)[0].files[0],l=parseFloat(n.size/1024).toFixed(2),o=new FileReader;return console.log("压缩前大小是"+l+"KB"),t.change&&!t.change(n)?!1:(a.filetype=n.type,a.filesize=l,a.filename=n.name,o.readAsDataURL(n),void(o.onload=function(){a.src=this.result,a.quality=t.quality?t.quality(l):l>4?10:l>2?20:l>1?20:.2>l?100:85,i(a,s)}))})}})}(jQuery);