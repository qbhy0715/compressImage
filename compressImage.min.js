!function(e){function i(i,a){e("#_img_hide,#_canvas").remove(),e("body").append(e('<canvas id="_canvas" style="display: none;"></canvas><img id="_img_hide" style="display: none;" >'));var t=new Image;t.src=i.src||"",e("#_img_hide").attr("src",i.src)[0].onload=function(){var n=e(this),s=document.getElementById("_canvas"),l=s.getContext("2d");0===i.limit||i.filesize>=i.limit?(s.width=n.width(),s.height=n.height(),l.drawImage(t,0,0),i.base64=s.toDataURL("image/jpeg",i.quality/100)):i.base64=i.src,i.img.attr({src:i.base64}),a(i)}}e.fn.extend({compressImage:function(a){var t={file:e(a.file),img:e(a.img),limit:a.limit?a.limit:200},n=t.file,s=a.callback||function(){};n.change(function(){var n=e(this)[0].files[0],l=parseFloat(n.size/1024).toFixed(2),c=new FileReader;return console.log("压缩前大小是"+l+"KB"),a.change&&!a.change(n)?!1:(t.filetype=n.type,t.filesize=l,t.filename=n.name,c.readAsDataURL(n),void(c.onload=function(){t.src=this.result,t.quality=a.quality?a.quality(l):l>4?10:l>2?20:l>1?20:.2>l?100:85,i(t,s)}))})}})}(jQuery);